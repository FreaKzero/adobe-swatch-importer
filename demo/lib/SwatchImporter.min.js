/*! adobe-swatch-importer 1.0.0 Copyright (C) 2015, Thomas Petrovic <pete@freakzero.com> 
 Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license */ 
define(function(){function a(a){function b(a){return null===a?"00":(a=parseInt(a),0===a||isNaN(a)?"00":(a=Math.max(0,a),a=Math.min(a,255),a=Math.round(a),"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)))}return"#"+b(a[0])+b(a[1])+b(a[2])}function b(){this.version,this.amount=0,this.colors=[],this.converted=!1,this.byteIndex=0}function c(a){switch(a){case"aco":return new e;case"ase":return new b}}var d=function(a){this.swatchType=a,this.name,this.origin,this.originformat,this.rgb,this.hash};d.prototype.rgb=function(b,c,d,e){this.name=b,this.originformat=this.swatchType.toUpperCase()+" RGB",this.origin=[c,d,e,0],"aco"===this.swatchType?this.rgb=[Math.floor(c/257),Math.floor(d/257),Math.floor(e/257)]:"ase"===this.swatchType&&(this.rgb=[256*c,256*d,256*e]),this.hash=a(this.rgb)},d.prototype.cmyk=function(b,c,d,e,f){var g;this.name=b,this.originformat=this.swatchType.toUpperCase()+" CMYK",this.origin=[c,d,e,f],"aco"===this.swatchType?(g=1-f/65535,this.rgb=[255*(1-(1-c/65535))*(1-g),255*(1-(1-d/65535))*(1-g),255*(1-(1-e/65535))*(1-g)]):"ase"===this.swatchType&&(g=255*f,this.rgb=[255*(1-c)*(1-g),255*(1-d)*(1-g),255*(1-e)*(1-g)]),this.hash=a(this.rgb)},d.prototype.hsb=function(b,c,d,e){function f(a,b,c){a=Math.floor(a/65535*360)/360,b=Math.floor(b/65535*100)/100,c=Math.floor(c/65535*100)/100;var d,e,f,g,h,i,j,k;switch(a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h),g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b),g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return[Math.floor(255*d),Math.floor(255*e),Math.floor(255*f)]}this.name=b,this.originformat="HSB",this.origin=[c,d,e],this.rgb=f(c,d,e),this.hash=a(this.rgb)};var e=function(){this.version,this.amount=0,this.colors=[],this.converted=!1,this.byteIndex=0};return e.prototype._readHead=function(a){this.amount=a.getInt8(3);var b=10*this.amount+5;return this.byteIndex=10*this.amount+9,2!==a.getInt8(b)?!1:!0},e.prototype.getColorSpace=function(a){var b={0:"RGB",1:"HSB",2:"CMYK",3:"PANTONE",4:"FOCOLTONE",5:"TRUMATCH",6:"TOYO88",7:"LAB",8:"GREYSCALE",10:"HKS"};return"undefined"!=typeof b[a]?b[a]:"INVALID COLORSPACE BYTE ["+a+"]"},e.prototype.getColors=function(a){var b;if(!this._readHead(a))return[];for(var c=0;c<this.amount;c++){b=this.byteIndex;var e=null,f=this.getColorSpace(a.getInt8(b)),g=2*a.getInt32(b+9),h=a.getString(g,b+12);switch(f){case"RGB":e=new d("aco"),e.rgb(h,a.getUint16(b+1),a.getUint16(b+3),a.getUint16(b+5));break;case"CMYK":e=new d("aco"),e.cmyk(h,a.getUint16(b+1),a.getUint16(b+3),a.getUint16(b+5),a.getUint16(b+7));break;case"HSB":e=new d("aco"),e.hsb(h,a.getUint16(b+1),a.getUint16(b+3),a.getUint16(b+5));break;default:console.log("Colorspace "+f+" not supported - skipping Color")}null!==e&&this.colors.push(e),this.byteIndex=this.byteIndex+g+14}return this.colors},b.prototype._readHead=function(a){var b=a.getString(4,0);return"ASEF"!==b?!1:(this.version=a.getUint16(4)+a.getUint16(6),this.amount=a.getUint32(8),this.byteIndex=16,!0)},b.prototype.getColors=function(a){var b;if(!this._readHead(a))return[];for(var c=0;c<this.amount;c++){var e=null;b=this.byteIndex;var f=a.getUint16(b),g=2*a.getUint16(b+2);b+=4;var h=a.getString(g,b),i=a.getString(4,b+g).trim();switch(b=b+g+4,i){case"RGB":e=new d("ase"),e.rgb(h,a.getFloat32(b),a.getFloat32(b+4),a.getFloat32(b+8));break;case"CMYK":e=new d("ase"),e.cmyk(h,a.getFloat32(b),a.getFloat32(b+4),a.getFloat32(b+8),a.getFloat32(b+10))}null!==e&&this.colors.push(e),this.byteIndex=this.byteIndex+f+6}return this.colors},c});